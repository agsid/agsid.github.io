<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allied Work Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the documentation layout */
        body {
            font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #f9fafb; /* Light gray background */
        }
        /* Style for the main content area */
        .prose h3 {
            margin-top: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb; /* Light gray border */
        }
    </style>
</head>
<body>

    <!-- Top Navigation Header -->
    <header class="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
            <div class="flex items-center">
                <span class="text-xl font-bold text-gray-900">
                    Allied Work
                </span>
                <span class="ml-4 text-sm text-gray-500 hidden md:inline">
                    Documentation
                </span>
            </div>
            <div class="flex items-center space-x-4">
                <!-- Search Input with ID for JavaScript functionality -->
                <input type="text" id="search-input" placeholder="Search documentation..." class="hidden sm:block w-64 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                <!-- Updated button/link to redirect to the project website -->
                <a href="https://agsid.github.io/website/" target="_blank" class="px-3 py-1.5 text-sm font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition duration-150 ease-in-out shadow-md">
                    View Project Website
                </a>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex relative">

            <!-- Sidebar Navigation -->
            <aside class="sticky top-16 hidden lg:block w-64 pt-10 pr-8 shrink-0 overflow-y-auto h-[calc(100vh-4rem)]">
                <nav class="space-y-6" id="sidebar-nav">
                    <div>
                        <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider">
                            Topics
                        </h3>
                        <!-- Links generated here by JavaScript -->
                        <div class="mt-3 space-y-2" id="nav-links-container">
                            <!-- JS content insertion point -->
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="min-w-0 w-full lg:w-[calc(100%-16rem)] pt-10 pb-12 lg:pr-10">
                <div class="max-w-none prose prose-lg" id="main-content-container">

                    <!-- Main Title Section -->
                    <h1 class="text-4xl font-extrabold tracking-tight text-gray-900 mb-6">
                        Allied Work Documentation
                    </h1>
                    <p class="mt-4 text-xl text-gray-500">
                        Use this documentation to understand the various projects and components under the Allied Work umbrella, from the coding editor to the AutoCorrection function.
                    </p>

                    <!-- Content generated here by JavaScript -->
                    <div id="dynamic-content-area" class="mt-12">
                        <!-- JS content insertion point -->
                    </div>

                    <!-- Previous/Next Navigation -->
                    <div class="mt-20 pt-8 border-t border-gray-200 text-sm text-gray-500 flex justify-between">
                        <div class="flex space-x-4">
                            <a href="#" id="prev-link" class="hover:text-gray-900 font-medium transition duration-150 ease-in-out hidden">&leftarrow; Previous</a>
                            <a href="#" id="next-link" class="hover:text-gray-900 font-medium transition duration-150 ease-in-out hidden">Next &rightarrow;</a>
                        </div>
                        <p class="text-right">Was this page helpful?</p>
                    </div>

                </div>
            </main>

        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-16 border-t border-gray-200 py-8 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-500">
            <p>&copy; 2024 Allied Work. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript to load and render content -->
    <script>
        // Content data provided by the user
        const pageContent = {
            'what-is-it': {
                title: 'Allied Work',
                paragraphs: [
                    `Allied Work allows users to see where their robots will go on the game mat with the built-in visualizer. This is very helpful because many times teams are using trial and error to reach their desired location on the game mat. Not only can teams do this, but they can also code with ease. The Allied Workspace allows users to code in its native language called Allied Work. Allied Work is made to be simple so everybody can code their robot. When you are done coding your path, you can press the run button to see the path of the robot, then copy the Python code from the built-in Python generator.`,
                ],
            },
            'AlliedAutoCorrectionBlocks': {
                title: 'Allied AutoCorrection Blocks',
                paragraphs: [
                    `Allied AutoCorrection is a beautiful and helpful function for all FLL teams. The function provides precision while running code. Imagine you are walking straight and you trip. Now you will get back in the same line you were walking in, and walk until you reach your final destination. Allied AutoCorrection is here to help the robot do the same. One of the sensors used is the gyro sensor. A gyro sensor helps track the robot's pitch, yaw, and roll. The code essentially checks if the robot’s current yaw or heading is within a range of 5 degrees from the target. If it isn’t, it checks whether the current heading is greater or less than the target. If it is greater, the robot turns left until it is within the 5-degree range. If it is less, the robot turns right until it reaches that range.
The code can be modified to run faster; however, increasing the speed often requires a larger acceptable range, while a smaller range typically demands more time.
`,
                ],
            },
            'related': {
                title: 'How they are related',
                paragraphs: [
                    `You may be asking how an autocorrection software and an auto correction function are related. Well, in the Allied Work editor whenever you code a command for movement such as \`drive\`, it takes the Allied AutoCorrection function and uses it to give accurate movements.`,
                ],
            },
            'AACWork': {
                title: 'How Does Allied AutoCorrection Work?',
                paragraphs: [
                    `Allied AutoCorrection works by continuously monitoring the robot's orientation and position using sensors, primarily the gyro sensor. If the robot deviates from its intended path or heading, the system automatically calculates the necessary corrections and adjusts the motor outputs to bring the robot back on track. This real-time feedback loop ensures that the robot maintains precision throughout its movement commands, compensating for external disturbances or inherent mechanical inaccuracies. This makes the robot's movements much more reliable and repeatable in a competitive environment.`,
                    `Beyond the gyro sensor, Allied AutoCorrection can integrate data from other sensors like encoders on wheels to measure distance traveled, or even color sensors to detect lines on the game mat. By combining these sensor inputs, the system creates a more comprehensive understanding of the robot's state and environment. This multi-sensor fusion allows for more accurate deviation detection and more precise corrective actions.`,
                    `The core of the auto-correction mechanism involves a PID (Proportional-Integral-Derivative) controller, or a similar control loop. This controller takes the error (the difference between the desired state and the actual state) and calculates an output to minimize that error. For instance, if the robot drifts slightly to the left, the controller would slightly increase the power to the right motor and decrease power to the left motor until the robot is back on its intended heading. The tuning of these control parameters is crucial for smooth and stable correction.`,
                ],
            },
            'benefits': {
                title: 'Benefits & Impact',
                paragraphs: [
                    `The combination of Allied Work's intuitive coding environment and Allied AutoCorrection's precision offers significant benefits to FLL teams. Firstly, it drastically reduces the learning curve for new team members, enabling them to contribute to robot programming much faster. The visualizer provides immediate feedback, transforming abstract code into tangible robot movements, which is invaluable for debugging and understanding complex paths.`,
                    `Secondly, and perhaps most critically, Allied AutoCorrection empowers teams to achieve higher scores in competitions. By ensuring consistent and accurate robot movements, it minimizes errors that often lead to missed mission objectives. This increased reliability allows teams to focus on refining their strategies and attempting more challenging tasks, rather than constantly troubleshooting basic movement issues. Ultimately, Allied Work fosters a more efficient, engaging, and successful robotics experience for students.`,
                ],
            },
            'additional': {
                title: 'Additional Considerations',
                paragraphs: [
                    `When implementing complex robot movements, integrating features like Allied AutoCorrection is crucial for consistent performance. Without it, minor errors can accumulate, leading to significant deviations from the desired path. The visualizer in Allied Work provides an immediate feedback loop for developers, allowing them to quickly identify and rectify any issues before deploying code to the physical robot. This significantly reduces the time spent on trial and error and improves overall development efficiency. Consider incorporating odometry for even greater accuracy.`,
                ],
            },
            'future-enhancements': {
                title: 'Future Enhancements',
                paragraphs: [
                    `Future enhancements for Allied Work could include more advanced path planning algorithms, integration with vision systems for object recognition and avoidance, and machine learning capabilities to optimize movement patterns over time. Imagine a robot that learns from its past runs and automatically refines its auto-correction parameters for even greater precision. These advancements would push the boundaries of what FLL teams can achieve with their robots.`,
                ],
            },
            'community': {
                title: 'Community and Support',
                paragraphs: [
                    `Building a strong community around Allied Work is essential. Providing forums, tutorials, and examples would empower users to get the most out of the platform. Sharing best practices for implementing Allied AutoCorrection in different scenarios could further enhance its utility. A dedicated support channel would ensure that teams receive timely assistance with any challenges they encounter, fostering a collaborative environment for innovation in robotics education.`,
                ],
            },
        };

        const contentKeys = Object.keys(pageContent);
        
        /**
         * Filters the main content sections and the sidebar navigation links 
         * based on the provided search term.
         */
        function filterContent(searchTerm) {
            const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();
            const contentSections = document.querySelectorAll('#dynamic-content-area > section');
            const navLinks = document.querySelectorAll('#nav-links-container a');
            let hasResults = false;
            const contentContainer = document.getElementById('main-content-container');
            let noResultsMessage = document.getElementById('no-results-message');

            contentSections.forEach(section => {
                // Get text from section title and all paragraphs
                const title = section.querySelector('h2').textContent.toLowerCase();
                const paragraphs = Array.from(section.querySelectorAll('p')).map(p => p.textContent.toLowerCase()).join(' ');
                
                // Check if search term is in the title or the combined paragraphs
                const isMatch = title.includes(lowerCaseSearchTerm) || paragraphs.includes(lowerCaseSearchTerm);
                
                // Find corresponding nav link using the section's ID
                const navLink = Array.from(navLinks).find(link => link.href.endsWith(`#${section.id}`));

                if (lowerCaseSearchTerm === '') {
                    // If search is empty, show everything
                    section.style.display = 'block';
                    if (navLink) navLink.style.display = 'block';
                    hasResults = true;
                } else if (isMatch) {
                    // Show matches
                    section.style.display = 'block';
                    if (navLink) navLink.style.display = 'block';
                    hasResults = true;
                } else {
                    // Hide non-matches
                    section.style.display = 'none';
                    if (navLink) navLink.style.display = 'none';
                }
            });

            // Handle "No results" message and navigation links below content
            if (!hasResults && lowerCaseSearchTerm !== '') {
                if (!noResultsMessage) {
                    // Create and append the no results message if it doesn't exist
                    const message = document.createElement('p');
                    message.id = 'no-results-message';
                    message.className = 'text-center text-xl text-gray-500 mt-20 p-8 border border-dashed border-gray-300 rounded-xl';
                    message.textContent = `Sorry, no results found for "${searchTerm}". Try a different term!`;
                    contentContainer.appendChild(message);
                }
                // Hide the previous/next navigation when actively searching
                document.getElementById('prev-link').classList.add('hidden');
                document.getElementById('next-link').classList.add('hidden');

            } else {
                // If there are results or search is cleared, remove the message
                if (noResultsMessage) {
                    noResultsMessage.remove();
                }
                // If search is cleared, re-run updateNav to show links for the current section
                if (lowerCaseSearchTerm === '') {
                    const activeKey = window.location.hash.substring(1) || contentKeys[0];
                    updateNav(activeKey);
                }
            }
        }

        function renderContent() {
            const navContainer = document.getElementById('nav-links-container');
            const contentArea = document.getElementById('dynamic-content-area');
            
            navContainer.innerHTML = ''; // Clear existing navigation links
            contentArea.innerHTML = '';  // Clear existing content

            // 1. Generate Navigation Links and Main Content Sections
            contentKeys.forEach((key, index) => {
                const section = pageContent[key];
                
                // --- Generate Sidebar Link ---
                const navLink = document.createElement('a');
                navLink.href = `#${key}`;
                navLink.className = `block text-sm transition duration-150 ease-in-out p-1 rounded-md ${index === 0 ? 'bg-blue-100 text-blue-700 font-bold' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'}`;
                navLink.textContent = section.title;
                
                // Simple click handler to manage active state and smooth scroll
                navLink.onclick = (e) => {
                    e.preventDefault();
                    // Clear search input when navigating via sidebar link
                    document.getElementById('search-input').value = '';
                    filterContent(''); 

                    document.querySelectorAll('#nav-links-container a').forEach(a => {
                        a.className = a.className.replace('bg-blue-100 text-blue-700 font-bold', 'text-gray-500 hover:text-gray-700 hover:bg-gray-50');
                    });
                    navLink.className = navLink.className.replace('text-gray-500 hover:text-gray-700 hover:bg-gray-50', 'bg-blue-100 text-blue-700 font-bold');
                    document.getElementById(key).scrollIntoView({ behavior: 'smooth' });
                    updateNav(key);
                };

                navContainer.appendChild(navLink);


                // --- Generate Main Content Section ---
                const contentSection = document.createElement('section');
                contentSection.id = key;
                contentSection.className = 'mb-12';
                
                // Title
                const titleElement = document.createElement('h2');
                titleElement.className = 'mt-10 pt-2 text-2xl font-semibold text-gray-900';
                titleElement.textContent = section.title;
                contentSection.appendChild(titleElement);
                
                // Paragraphs
                section.paragraphs.forEach(pText => {
                    const pElement = document.createElement('p');
                    pElement.className = 'mt-4 text-gray-700';
                    // Replace inline code formatting from markdown backticks
                    pElement.innerHTML = pText.replace(/`([^`]+)`/g, (match, code) => 
                        `<code class="bg-gray-100 text-red-600 px-1 py-0.5 rounded">${code}</code>`
                    );
                    contentSection.appendChild(pElement);
                });
                
                contentArea.appendChild(contentSection);
            });
            
            // 2. Set up initial state and event listeners for hash change
            window.addEventListener('hashchange', () => {
                // Ensure search is cleared on hash change
                document.getElementById('search-input').value = '';
                filterContent(''); 
                updateActiveLink(window.location.hash.substring(1));
            });
            
            // 3. Attach search listener to the input field
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                // Call filterContent on every key press
                filterContent(e.target.value);
            });

            // Check initial hash or default to the first section
            const initialKey = window.location.hash.substring(1) || contentKeys[0];
            updateActiveLink(initialKey);
        }

        function updateActiveLink(activeKey) {
            document.querySelectorAll('#nav-links-container a').forEach(a => {
                // Only update the active link if it's currently visible (i.e., not filtered out)
                if (a.style.display !== 'none' && a.href.includes(activeKey)) {
                    a.className = a.className.replace('text-gray-500 hover:text-gray-700 hover:bg-gray-50', 'bg-blue-100 text-blue-700 font-bold');
                } else {
                    a.className = a.className.replace('bg-blue-100 text-blue-700 font-bold', 'text-gray-500 hover:text-gray-700 hover:bg-gray-50');
                }
            });
            updateNav(activeKey);
        }

        function updateNav(activeKey) {
            const searchInput = document.getElementById('search-input');
            // Only show Prev/Next links if the search bar is empty
            if (searchInput && searchInput.value.trim() !== '') {
                document.getElementById('prev-link').classList.add('hidden');
                document.getElementById('next-link').classList.add('hidden');
                return;
            }

            const index = contentKeys.indexOf(activeKey);
            const prevLink = document.getElementById('prev-link');
            const nextLink = document.getElementById('next-link');

            // Reset visibility
            prevLink.classList.add('hidden');
            nextLink.classList.add('hidden');

            // Handle Previous Link
            if (index > 0) {
                const prevKey = contentKeys[index - 1];
                prevLink.href = `#${prevKey}`;
                prevLink.textContent = `← ${pageContent[prevKey].title}`;
                prevLink.classList.remove('hidden');
            }

            // Handle Next Link
            if (index < contentKeys.length - 1) {
                const nextKey = contentKeys[index + 1];
                nextLink.href = `#${nextKey}`;
                nextLink.textContent = `${pageContent[nextKey].title} →`;
                nextLink.classList.remove('hidden');
            }
        }

        // Run the rendering function when the page loads
        document.addEventListener('DOMContentLoaded', renderContent);

    </script>

</body>
</html>

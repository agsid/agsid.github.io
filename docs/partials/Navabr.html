<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Allied Work Docs</title>
<link rel="icon" type="image/x-icon" href="">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root {
    --sidebar-w: 260px;
    --navbar-h: 64px;
  }

  html, body {
    height: 100%;
    margin: 0;
    background-color: #000;
    color: #fff;
    font-family: 'Karla', sans-serif;
    overflow: hidden;
  }

  /* Navbar */
  nav {
    position: fixed;
    top: 0;
    left: var(--sidebar-w);
    right: 0;
    height: var(--navbar-h);
    z-index: 50;
    backdrop-filter: blur(12px);
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  nav a {
    transition: color 0.2s;
  }

  nav a:hover {
    color: #f0abfc;
  }

  /* Sidebar */
  #sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: var(--sidebar-w);
    height: 100%;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(14px);
    border-right: 1px solid rgba(255, 255, 255, 0.06);
    padding: 1rem;
    box-sizing: border-box;
    overflow-y: auto;
  }

  /* Scrollbar */
  #sidebar::-webkit-scrollbar,
  #main-content::-webkit-scrollbar {
    width: 6px;
  }
  #sidebar::-webkit-scrollbar-thumb,
  #main-content::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 6px;
  }

  /* Main content */
  #main-content {
    position: absolute;
    top: var(--navbar-h);
    left: var(--sidebar-w);
    right: 0;
    bottom: 0;
    overflow: hidden;
  }

  iframe {
    width: 100%;
    height: 100%;
    border: none;
    margin: 0;
    padding: 0;
    background: transparent;
  }

  /* Search Bar */
  #searchBar {
    width: 100%;
    background: rgba(255, 255, 255, 0.08);
    border: none;
    outline: none;
    padding: 0.6rem 0.8rem;
    border-radius: 8px;
    color: white;
    margin-bottom: 0.8rem;
  }

  #searchBar::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }
</style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar">
  <input id="searchBar" placeholder="Search docs...">
  <div id="sidebar-links"></div>
</div>

<!-- Navbar -->
<nav>
  <a href="index.html" class="font-bold text-2xl bg-gradient-to-r from-fuchsia-500 via-cyan-400 to-teal-400 bg-clip-text text-transparent">
    Allied Work
  </a>
  <div class="flex space-x-6">
    <a href="#" onclick="loadPage('../index.html')">Docs</a>
    <a href="#" onclick="loadPage('../changelog.html')">Changelog</a>
  </div>
</nav>

<!-- Main content (iframe) -->
<div id="main-content">
  <iframe id="contentFrame" title="Main Content"></iframe>
</div>

<script>
  let currentPage = "../index.html"; // default iframe page

  window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("contentFrame").src = currentPage;
  });

  // Sidebar data
  const docsData = [
    {
      title: "Getting Started",
      pages: [
        { title: "Introduction", hash: "#introduction" },
        { title: "Why?", hash: "#why" },
        { title: "What is it?", hash: "#what" },
        { title: "How to get started", hash: "#how-to-get-started" },
        { title: "Syntax and Structure", hash: "#syntax" }
      ]
    },
    {
      title: "Commands",
      pages: [
        { title: "Drive", href: "commands/drive.html" },
        { title: "Turn", href: "commands/turn.html" },
        { title: "Arm", href: "commands/arm.html" },
        { title: "Extra", href: "commands/extra.html" }
      ]
    },
    {
      title: "Examples",
      pages: [
        { title: "Basic Movement", href: "examples/basic-movement.html" },
        { title: "Using the Arm", href: "examples/using-the-arm.html" },
        { title: "Combining Commands", href: "examples/combining-commands.html" }
      ]
    },
    {
      title: "AutoCorrection",
      pages: [
        { title: "How to use", href: "autocorrection/how-to-use.html" },
        { title: "Improving Performance", href: "autocorrection/improving-performance.html" },
        { title: "How it works", href: "autocorrection/how-it-works.html" }
      ]
    }
  ];

  // Render sidebar
  function renderSidebar(filter = "") {
    const sidebar = document.getElementById("sidebar-links");
    sidebar.innerHTML = "";

    docsData.forEach(section => {
      const matched = section.pages.filter(p =>
        (p.title || "").toLowerCase().includes(filter.toLowerCase())
      );
      if (!matched.length) return;

      const sectionTitle = document.createElement("p");
      sectionTitle.className = "mt-4 mb-2 text-gray-400 font-semibold text-xs uppercase";
      sectionTitle.textContent = section.title;
      sidebar.appendChild(sectionTitle);

      matched.forEach(page => {
        const link = document.createElement("a");
        link.href = "#";
        link.textContent = page.title;
        link.className = "block py-2 px-3 mb-1 rounded-lg hover:bg-fuchsia-500/30 transition text-gray-200";

        link.onclick = async () => {
          const iframe = document.getElementById("contentFrame");
          const targetPage = "../docs/gettingstarted.html";
          const targetHash = page.hash || "";

          // If this is a Getting Started link
          if (section.title === "Getting Started") {
            // Case 1: Already on gettingstarted.html — just scroll smoothly
            if (iframe.src.includes("gettingstarted.html")) {
              try {
                const doc = iframe.contentDocument || iframe.contentWindow.document;
                const target = doc.querySelector(targetHash);
                if (target) {
                  target.scrollIntoView({ behavior: "smooth", block: "start" });
                }
              } catch (err) {
                console.warn("Unable to access iframe for smooth scroll:", err);
              }
            } 
            // Case 2: Not yet on gettingstarted.html — load it first
            else {
              loadPage(`${targetPage}${targetHash}`);
              iframe.addEventListener("load", function scrollAfterLoad() {
                try {
                  const doc = iframe.contentDocument || iframe.contentWindow.document;
                  const target = doc.querySelector(targetHash);
                  if (target) {
                    target.scrollIntoView({ behavior: "smooth", block: "start" });
                  }
                } catch (err) {}
                iframe.removeEventListener("load", scrollAfterLoad);
              });
            }
          } else {
            // All other pages
            loadPage(page.href);
          }
        };

        sidebar.appendChild(link);
      });
    });
  }

  // Search function
  document.getElementById("searchBar").addEventListener("input", e => {
    renderSidebar(e.target.value);
  });

  // Load page into iframe + toggle sidebar for changelog
  function loadPage(href) {
    const iframe = document.getElementById("contentFrame");
    const sidebar = document.getElementById("sidebar");
    const nav = document.querySelector("nav");

    currentPage = href;
    iframe.src = currentPage;

    // Hide sidebar when changelog is opened
    if (href.includes("changelog.html")) {
      sidebar.style.display = "none";
      nav.style.left = "0";
    } else {
      sidebar.style.display = "block";
      nav.style.left = "var(--sidebar-w)";
    }
  }

  // Cleanup iframe style on load
  document.getElementById("contentFrame").addEventListener("load", () => {
    try {
      const doc = document.getElementById("contentFrame").contentDocument;
      doc.body.style.margin = "0";
      doc.body.style.padding = "0";
      doc.documentElement.style.background = "transparent";
    } catch (e) {
      console.warn("Cannot modify iframe content (cross-origin).");
    }
  });

  renderSidebar();
</script>




</body>
</html>
